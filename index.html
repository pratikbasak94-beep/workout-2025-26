<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformation Tracker</title>
    <style>
        :root { --primary: #2563eb; --bg: #f3f4f6; --card: #ffffff; --text: #1f2937; --success: #10b981; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; }
        .container { max-width: 600px; margin: 0 auto; padding-bottom: 80px; }
        
        /* Header & Navigation */
        header { text-align: center; margin-bottom: 20px; }
        h1 { color: var(--primary); margin: 0; font-size: 1.5rem; }
        .nav-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-nav { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-nav:hover { opacity: 0.9; }
        .current-range { font-weight: bold; font-size: 0.9rem; }

        /* Cards */
        .day-card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; border-left: 5px solid var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .sunday-card { border-left-color: var(--success); }
        
        .day-header { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .day-name { font-weight: bold; }
        .day-date { background: #e0e7ff; color: var(--primary); padding: 2px 8px; border-radius: 4px; font-size: 0.85rem; font-weight: 600; }

        .section-header { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; margin-bottom: 5px; }
        .section-title { font-size: 0.8rem; text-transform: uppercase; color: #888; font-weight: bold; }
        .btn-edit { background: none; border: 1px solid #ddd; border-radius: 4px; color: #666; font-size: 0.7rem; cursor: pointer; padding: 2px 6px; }
        .btn-edit:hover { background: #eee; color: var(--primary); }

        /* Checkboxes */
        .checklist-item { display: flex; align-items: center; padding: 6px 0; cursor: pointer; }
        input[type="checkbox"] { width: 18px; height: 18px; margin-right: 10px; accent-color: var(--success); }
        input[type="checkbox"]:checked + span { text-decoration: line-through; color: #9ca3af; }

        /* Sync Controls */
        .sync-area { margin-top: 30px; border-top: 2px dashed #ccc; padding-top: 20px; text-align: center; }
        .btn-backup { background: #4b5563; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 0.9rem; }
        .btn-restore { background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 0.9rem; }
        #file-input { display: none; }

        /* Stats */
        .stats-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 10px; border-top: 1px solid #eee; text-align: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .progress-text { font-size: 0.9rem; font-weight: bold; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Track Your Progress</h1>
        <div class="nav-controls">
            <button class="btn-nav" onclick="changeWeek(-7)">&#8592; Prev</button>
            <span class="current-range" id="week-display">...</span>
            <button class="btn-nav" onclick="changeWeek(7)">Next &#8594;</button>
        </div>
    </header>

    <div id="tracker-app"></div>

    <div class="sync-area">
        <p style="font-size:0.8rem; color:#666; margin-bottom:10px;">Backup your data (includes your custom diet & workouts)</p>
        <button class="btn-backup" onclick="downloadData()">üíæ Save Progress</button>
        <button class="btn-restore" onclick="triggerUpload()">üìÇ Load Data</button>
        <input type="file" id="file-input" accept=".json" onchange="loadData(this)">
    </div>
</div>

<div class="stats-bar">
    <div class="progress-text" id="completion-rate">Weekly Progress: 0%</div>
</div>

<script>
    // --- CONFIGURATION ---
    const baseDate = new Date(2025, 11, 15); // Dec 15, 2025
    let currentMonday = new Date(baseDate);

    // --- DEFAULT WORKOUT DATA ---
    const defaultWorkoutPlan = [
        { type: "Lower Body", tasks: ["Sit-to-Stand: 3x5", "Wall Sit: 2x20s", "Leg Lifts: 2x8"] },
        { type: "Upper Body A", tasks: ["Tube Rows: 3x12", "Tube Shoulder Press: 3x10", "Tube Face Pulls: 3x12"] },
        { type: "Lower Body", tasks: ["Sit-to-Stand: 3x5", "Wall Sit: 2x20s", "Leg Lifts: 2x8"] },
        { type: "CHEST DAY", tasks: ["Tube Chest Press: 3x12", "Incline Pushups: 3x5", "Tube Flys: 3x12"] },
        { type: "Lower Body", tasks: ["Sit-to-Stand: 3x5", "Wall Sit: 2x20s", "Leg Lifts: 2x8"] },
        { type: "Upper Body B", tasks: ["Tube Bicep Curls: 3x12", "Tube Tricep Pushdown: 3x12", "Forearm Twists: 3x20s"] },
        { type: "REST DAY", tasks: ["No Gym", "Walk Only", "Sleep Well"] }
    ];

    // --- DEFAULT DIET DATA (With your Custom Sunday) ---
    const defaultStandardDiet = [ "9AM: 50g Sattu + Lemon", "11AM: Lunch (Rotis/Rice + Sabzi)", "2:30PM: Fruit", "6:30PM: Tea (NO BISCUIT)", "8:30PM: 2 Rotis (Dry)" ];
    
    const defaultSundayDiet = [ 
        "10AM: Sattu + Lemon",       // Late Breakfast
        "1PM: Fruit (Singapuri)",    // Fruit BEFORE Lunch
        "3PM: Lunch (CHICKEN)",      // Late Lunch
        "6:30PM: Tea (No Biscuit)",
        "8:30PM: 2 Rotis (Dry)"
    ];

    // Create a default array for 7 days
    const defaultDietWeek = [
        defaultStandardDiet, // Mon
        defaultStandardDiet, // Tue
        defaultStandardDiet, // Wed
        defaultStandardDiet, // Thu
        defaultStandardDiet, // Fri
        defaultStandardDiet, // Sat
        defaultSundayDiet    // Sun
    ];

    // --- LOAD STATE OR USE DEFAULT ---
    let workoutPlan = JSON.parse(localStorage.getItem('pratik_custom_workout')) || JSON.parse(JSON.stringify(defaultWorkoutPlan));
    let dietPlan = JSON.parse(localStorage.getItem('pratik_custom_diet')) || JSON.parse(JSON.stringify(defaultDietWeek));

    const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

    // --- APP LOGIC ---

    function init() {
        renderWeek();
    }

    function changeWeek(offsetDays) {
        currentMonday.setDate(currentMonday.getDate() + offsetDays);
        renderWeek();
    }

    function renderWeek() {
        const app = document.getElementById('tracker-app');
        app.innerHTML = '';
        
        let totalTasks = 0;
        let completedTasks = 0;

        let sunday = new Date(currentMonday);
        sunday.setDate(currentMonday.getDate() + 6);
        
        document.getElementById('week-display').innerText = 
            formatDate(currentMonday) + ' - ' + formatDate(sunday);

        for (let i = 0; i < 7; i++) {
            let cardDate = new Date(currentMonday);
            cardDate.setDate(currentMonday.getDate() + i);
            let dateStr = formatDate(cardDate);
            let storageDateKey = cardDate.toISOString().split('T')[0]; 

            let dayName = days[i];
            let wPlan = workoutPlan[i];
            let dPlan = dietPlan[i];
            let cardClass = (dayName === "Sunday") ? "day-card sunday-card" : "day-card";

            // Generate Diet HTML
            let dietHtml = "";
            dPlan.forEach((item, idx) => {
                let id = storageDateKey + 'diet' + idx;
                let isChecked = localStorage.getItem(id) === 'true';
                if(isChecked) completedTasks++;
                totalTasks++;
                dietHtml += createCheckbox(id, item, isChecked);
            });

            // Generate Workout HTML
            let workoutHtml = "";
            wPlan.tasks.forEach((item, idx) => {
                let id = storageDateKey + 'workout' + idx;
                let isChecked = localStorage.getItem(id) === 'true';
                if(isChecked) completedTasks++;
                totalTasks++;
                workoutHtml += createCheckbox(id, item, isChecked);
            });

            // Add Edit Buttons to BOTH sections
            app.innerHTML += 
                '<div class="' + cardClass + '">' +
                    '<div class="day-header">' +
                        '<span class="day-name">' + dayName + '</span>' +
                        '<span class="day-date">' + dateStr + '</span>' +
                    '</div>' +
                    
                    '<div class="section-header">' +
                        '<span class="section-title">üçΩ Diet</span>' +
                        '<button class="btn-edit" onclick="editDiet(' + i + ')">Edit</button>' +
                    '</div>' + 
                    dietHtml +

                    '<div class="section-header">' +
                        '<span class="section-title" style="color:var(--primary)">üèã ' + wPlan.type + '</span>' +
                        '<button class="btn-edit" onclick="editWorkout(' + i + ')">Edit</button>' +
                    '</div>' + 
                    workoutHtml +
                '</div>';
        }
        
        updateStats(completedTasks, totalTasks);
    }

    // --- EDIT FUNCTIONS ---
    
    function editDiet(dayIndex) {
        let currentItems = dietPlan[dayIndex];
        let newItems = [];
        
        // Loop through the 5 meal slots
        for(let j=0; j<5; j++) {
            let val = prompt("Meal " + (j+1) + ":", currentItems[j]);
            if (val === null) return; // Cancelled
            newItems.push(val);
        }

        // Save
        dietPlan[dayIndex] = newItems;
        localStorage.setItem('pratik_custom_diet', JSON.stringify(dietPlan));
        renderWeek();
    }

    function editWorkout(dayIndex) {
        let currentTasks = workoutPlan[dayIndex].tasks;
        let newTasks = [];

        // Loop through the 3 workout slots
        for(let j=0; j<3; j++) {
            let val = prompt("Exercise " + (j+1) + ":", currentTasks[j]);
            if (val === null) return;
            newTasks.push(val);
        }

        // Save
        workoutPlan[dayIndex].tasks = newTasks;
        localStorage.setItem('pratik_custom_workout', JSON.stringify(workoutPlan));
        renderWeek();
    }

    function createCheckbox(id, text, checked) {
        let checkedAttr = checked ? 'checked' : '';
        return '<label class="checklist-item">' +
                '<input type="checkbox" id="' + id + '" ' + checkedAttr + ' onchange="toggleTask(this)">' +
                '<span>' + text + '</span>' +
            '</label>';
    }

    function toggleTask(checkbox) {
        localStorage.setItem(checkbox.id, checkbox.checked);
        renderWeek(); 
    }

    function formatDate(date) {
        return date.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
    }

    function updateStats(completed, total) {
        let percent = Math.round((completed / total) * 100);
        document.getElementById('completion-rate').innerText = 'Weekly Progress: ' + percent + '%';
    }

    // --- DATA BACKUP FUNCTIONS ---

    function downloadData() {
        const data = JSON.stringify(localStorage);
        const blob = new Blob([data], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Pratik_Fitness_Data.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    function triggerUpload() {
        document.getElementById('file-input').click();
    }

    function loadData(input) {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                localStorage.clear();
                for (let key in data) {
                    localStorage.setItem(key, data[key]);
                }
                
                // Reload custom plans if they exist
                if (data['pratik_custom_workout']) workoutPlan = JSON.parse(data['pratik_custom_workout']);
                if (data['pratik_custom_diet']) dietPlan = JSON.parse(data['pratik_custom_diet']);

                alert('Success! Data loaded.');
                location.reload(); 
            } catch (err) {
                alert('Error reading file.');
            }
        };
        reader.readAsText(file);
    }

    init();

</script>
</body>
</html>
